
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="using LLM to create and Explore topics in an innovative way">
      
      
        <meta name="author" content="Charles de Dampierre">
      
      
        <link rel="canonical" href="https://charlesdedampierre.github.io/BunkaTopics/bunka-api/bunkatopics.html">
      
      
        <link rel="prev" href="../technology.html">
      
      
        <link rel="next" href="topic_modeling/topic_model_builder.html">
      
      
      <link rel="icon" href="../img/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.4">
    
    
      
        <title>Bunka - BunkaTopics</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="black" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#bunka" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="BunkaTopics" class="md-header__button md-logo" aria-label="BunkaTopics" data-md-component="logo">
      
  <img src="../img/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BunkaTopics
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Bunka
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="black" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="white" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/charlesdedampierre/BunkaTopics" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../index.html" class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../getting-started.html" class="md-tabs__link">
        
  
    
  
  Getting Started

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../technology.html" class="md-tabs__link">
        
  
    
  
  Frame Analysis

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../fine-tuning.md" class="md-tabs__link">
        
  
    
  
  Fine-tuning LLM with qualitative data

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="bunkatopics.html" class="md-tabs__link">
          
  
  API

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../changelog.html" class="md-tabs__link">
        
  
    
  
  Changelog

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="BunkaTopics" class="md-nav__button md-logo" aria-label="BunkaTopics" data-md-component="logo">
      
  <img src="../img/logo.png" alt="logo">

    </a>
    BunkaTopics
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/charlesdedampierre/BunkaTopics" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../technology.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Frame Analysis
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../fine-tuning.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fine-tuning LLM with qualitative data
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Bunka
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="bunkatopics.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Bunka
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#bunkatopics._bunkatopics.Bunka" class="md-nav__link">
    <span class="md-ellipsis">
      Bunka
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bunkatopics._bunkatopics.Bunka.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bunkatopics._bunkatopics.Bunka.clean_data_by_topics" class="md-nav__link">
    <span class="md-ellipsis">
      clean_data_by_topics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bunkatopics._bunkatopics.Bunka.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bunkatopics._bunkatopics.Bunka.get_clean_topic_name" class="md-nav__link">
    <span class="md-ellipsis">
      get_clean_topic_name
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bunkatopics._bunkatopics.Bunka.get_topic_repartition" class="md-nav__link">
    <span class="md-ellipsis">
      get_topic_repartition
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bunkatopics._bunkatopics.Bunka.get_topics" class="md-nav__link">
    <span class="md-ellipsis">
      get_topics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bunkatopics._bunkatopics.Bunka.manually_clean_topics" class="md-nav__link">
    <span class="md-ellipsis">
      manually_clean_topics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bunkatopics._bunkatopics.Bunka.rag_query" class="md-nav__link">
    <span class="md-ellipsis">
      rag_query
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bunkatopics._bunkatopics.Bunka.visualize_bourdieu" class="md-nav__link">
    <span class="md-ellipsis">
      visualize_bourdieu
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bunkatopics._bunkatopics.Bunka.visualize_bourdieu_one_dimension" class="md-nav__link">
    <span class="md-ellipsis">
      visualize_bourdieu_one_dimension
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bunkatopics._bunkatopics.Bunka.visualize_dimensions" class="md-nav__link">
    <span class="md-ellipsis">
      visualize_dimensions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bunkatopics._bunkatopics.Bunka.visualize_topics" class="md-nav__link">
    <span class="md-ellipsis">
      visualize_topics
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="topic_modeling/topic_model_builder.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Topic Modeling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="topic_modeling/terms_extractor.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Term Extractor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="topic_modeling/topic_llm_cleaning.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Topic LLM Cleaner
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="bourdieu/bourdieu-api.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bourdieu API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6" >
        
          
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Visualization
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            Visualization
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="visualization/topic-visualization.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Topic Modeling Visualization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="bourdieu/bourdieu-visualization.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bourdieu Visualization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="bourdieu/bourdieu-visualization-one-dimension.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bourdieu Visualization One Dimension
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../changelog.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Changelog
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#bunkatopics._bunkatopics.Bunka" class="md-nav__link">
    <span class="md-ellipsis">
      Bunka
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bunkatopics._bunkatopics.Bunka.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bunkatopics._bunkatopics.Bunka.clean_data_by_topics" class="md-nav__link">
    <span class="md-ellipsis">
      clean_data_by_topics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bunkatopics._bunkatopics.Bunka.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bunkatopics._bunkatopics.Bunka.get_clean_topic_name" class="md-nav__link">
    <span class="md-ellipsis">
      get_clean_topic_name
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bunkatopics._bunkatopics.Bunka.get_topic_repartition" class="md-nav__link">
    <span class="md-ellipsis">
      get_topic_repartition
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bunkatopics._bunkatopics.Bunka.get_topics" class="md-nav__link">
    <span class="md-ellipsis">
      get_topics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bunkatopics._bunkatopics.Bunka.manually_clean_topics" class="md-nav__link">
    <span class="md-ellipsis">
      manually_clean_topics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bunkatopics._bunkatopics.Bunka.rag_query" class="md-nav__link">
    <span class="md-ellipsis">
      rag_query
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bunkatopics._bunkatopics.Bunka.visualize_bourdieu" class="md-nav__link">
    <span class="md-ellipsis">
      visualize_bourdieu
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bunkatopics._bunkatopics.Bunka.visualize_bourdieu_one_dimension" class="md-nav__link">
    <span class="md-ellipsis">
      visualize_bourdieu_one_dimension
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bunkatopics._bunkatopics.Bunka.visualize_dimensions" class="md-nav__link">
    <span class="md-ellipsis">
      visualize_dimensions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bunkatopics._bunkatopics.Bunka.visualize_topics" class="md-nav__link">
    <span class="md-ellipsis">
      visualize_topics
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="bunka">Bunka<a class="headerlink" href="#bunka" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-class">



<a id="bunkatopics._bunkatopics.Bunka"></a>
  <div class="doc doc-contents first">

  
      <p>The Bunka class for managing and analyzing textual data using various NLP techniques.</p>
<p>Examples:
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">bunkatopics</span> <span class="kn">import</span> <span class="n">Bunka</span>
<span class="kn">from</span> <span class="nn">datasets</span> <span class="kn">import</span> <span class="n">load_dataset</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># Extract Data</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;rguo123/trump_tweets&quot;</span><span class="p">)[</span><span class="s2">&quot;train&quot;</span><span class="p">][</span><span class="s2">&quot;content&quot;</span><span class="p">]</span>
<span class="n">docs</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="n">bunka</span> <span class="o">=</span> <span class="n">Bunka</span><span class="p">()</span>
<span class="n">topics</span> <span class="o">=</span> <span class="n">bunka</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
<span class="n">bunka</span><span class="o">.</span><span class="n">visualize_topics</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span>
</code></pre></div></p>

            <details class="quote">
              <summary>Source code in <code>bunkatopics/_bunkatopics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Bunka</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The Bunka class for managing and analyzing textual data using various NLP techniques.</span>

<span class="sd">    Examples:</span>
<span class="sd">    ```python</span>
<span class="sd">    from bunkatopics import Bunka</span>
<span class="sd">    from datasets import load_dataset</span>
<span class="sd">    import random</span>

<span class="sd">    # Extract Data</span>
<span class="sd">    dataset = load_dataset(&quot;rguo123/trump_tweets&quot;)[&quot;train&quot;][&quot;content&quot;]</span>
<span class="sd">    docs = random.sample(dataset, 1000)</span>

<span class="sd">    bunka = Bunka()</span>
<span class="sd">    topics = bunka.fit_transform(docs)</span>
<span class="sd">    bunka.visualize_topics(width=800, height=800)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">embedding_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">language</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;english&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize a BunkaTopics instance.</span>

<span class="sd">        Arguments:</span>
<span class="sd">           embedding_model : An optional embedding model for generating document embeddings.</span>
<span class="sd">               If not provided, a default model will be used based on the specified language.</span>
<span class="sd">               Default: None</span>
<span class="sd">           language : The language to be used for text processing and modeling.</span>
<span class="sd">               Options: &quot;english&quot; (default), or specify another language as needed.</span>
<span class="sd">               Default: &quot;english&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">LangChainDeprecationWarning</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">embedding_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">language</span> <span class="o">==</span> <span class="s2">&quot;english&quot;</span><span class="p">:</span>
                <span class="n">embedding_model</span> <span class="o">=</span> <span class="n">HuggingFaceEmbeddings</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;all-MiniLM-L6-v2&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">embedding_model</span> <span class="o">=</span> <span class="n">HuggingFaceEmbeddings</span><span class="p">(</span>
                    <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;paraphrase-multilingual-MiniLM-L12-v2&quot;</span>
                <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">embedding_model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">language</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_cleaned</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">docs</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">ids</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">DOC_ID</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fits the Bunka model to the provided list of documents.</span>

<span class="sd">        This method processes the documents, extracts terms, generates embeddings, and</span>
<span class="sd">        applies dimensionality reduction to prepare the data for topic modeling.</span>

<span class="sd">        Args:</span>
<span class="sd">            docs (t.List[str]): A list of document strings.</span>
<span class="sd">            ids (t.Optional[t.List[DOC_ID]]): Optional. A list of identifiers for the documents. If not provided, UUIDs are generated.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">])</span>

        <span class="c1"># Transform into a Document model</span>
        <span class="k">if</span> <span class="n">ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;doc_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ids</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;doc_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())[:</span><span class="mi">8</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Document</span><span class="p">(</span><span class="o">**</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="p">)]</span>
        <span class="n">sentences</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span><span class="o">.</span><span class="n">content</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">]</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span><span class="o">.</span><span class="n">doc_id</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">]</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Embedding documents... (can take varying amounts of time depending on their size)&quot;</span>
        <span class="p">)</span>

        <span class="n">characters</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span>
        <span class="n">random_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">characters</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>

        <span class="n">df_loader</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])</span>
        <span class="n">df_loader</span><span class="p">[</span><span class="s2">&quot;doc_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ids</span>

        <span class="n">loader</span> <span class="o">=</span> <span class="n">DataFrameLoader</span><span class="p">(</span><span class="n">df_loader</span><span class="p">,</span> <span class="n">page_content_column</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
        <span class="n">documents_langchain</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vectorstore</span> <span class="o">=</span> <span class="n">Chroma</span><span class="o">.</span><span class="n">from_documents</span><span class="p">(</span>
            <span class="n">documents_langchain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span> <span class="n">collection_name</span><span class="o">=</span><span class="n">random_string</span>
        <span class="p">)</span>

        <span class="n">bunka_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;doc_id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorstore</span><span class="o">.</span><span class="n">get</span><span class="p">()[</span><span class="s2">&quot;metadatas&quot;</span><span class="p">]]</span>
        <span class="n">bunka_docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorstore</span><span class="o">.</span><span class="n">get</span><span class="p">()[</span><span class="s2">&quot;documents&quot;</span><span class="p">]</span>
        <span class="n">bunka_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorstore</span><span class="o">.</span><span class="n">_collection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;embeddings&quot;</span><span class="p">])[</span>
            <span class="s2">&quot;embeddings&quot;</span>
        <span class="p">]</span>

        <span class="c1"># Add to the bunka objects</span>
        <span class="n">emb_doc_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bunka_ids</span><span class="p">,</span> <span class="n">bunka_embeddings</span><span class="p">)}</span>
        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">:</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">embedding</span> <span class="o">=</span> <span class="n">emb_doc_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">doc_id</span><span class="p">,</span> <span class="p">[])</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Reducing the dimensions of embeddings...&quot;</span><span class="p">)</span>
        <span class="n">reducer</span> <span class="o">=</span> <span class="n">umap</span><span class="o">.</span><span class="n">UMAP</span><span class="p">(</span>
            <span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>  <span class="c1"># Not random state to go quicker</span>
        <span class="n">bunka_embeddings_2D</span> <span class="o">=</span> <span class="n">reducer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">bunka_embeddings</span><span class="p">)</span>
        <span class="n">df_embeddings_2D</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">bunka_embeddings_2D</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">])</span>
        <span class="n">df_embeddings_2D</span><span class="p">[</span><span class="s2">&quot;doc_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bunka_ids</span>
        <span class="n">df_embeddings_2D</span><span class="p">[</span><span class="s2">&quot;bunka_docs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bunka_docs</span>

        <span class="n">xy_dict</span> <span class="o">=</span> <span class="n">df_embeddings_2D</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;doc_id&quot;</span><span class="p">)[[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>

        <span class="c1"># Update the documents with the x and y values from the DataFrame</span>
        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">:</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">xy_dict</span><span class="p">[</span><span class="n">doc</span><span class="o">.</span><span class="n">doc_id</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">]</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">xy_dict</span><span class="p">[</span><span class="n">doc</span><span class="o">.</span><span class="n">doc_id</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df_embeddings_2D</span> <span class="o">=</span> <span class="n">df_embeddings_2D</span>

        <span class="c1"># Create a scatter plot</span>
        <span class="n">fig_quick_embedding</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df_embeddings_2D</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">hover_data</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;bunka_docs&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># Update layout for better readability</span>
        <span class="n">fig_quick_embedding</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Raw Scatter Plot of Bunka Embeddings&quot;</span><span class="p">,</span>
            <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;X Embedding&quot;</span><span class="p">,</span>
            <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Y Embedding&quot;</span><span class="p">,</span>
            <span class="n">hovermode</span><span class="o">=</span><span class="s2">&quot;closest&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># Show the plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_quick_embedding</span> <span class="o">=</span> <span class="n">fig_quick_embedding</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Extracting meaningful terms from documents...&quot;</span><span class="p">)</span>
        <span class="n">terms_extractor</span> <span class="o">=</span> <span class="n">TextacyTermsExtractor</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">terms</span><span class="p">,</span> <span class="n">indexed_terms_dict</span> <span class="o">=</span> <span class="n">terms_extractor</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">sentences</span><span class="p">)</span>

        <span class="c1"># add to the docs object</span>
        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">:</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">term_id</span> <span class="o">=</span> <span class="n">indexed_terms_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">doc_id</span><span class="p">,</span> <span class="p">[])</span>

    <span class="k">def</span> <span class="nf">get_topics</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">n_clusters</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">ngrams</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="n">name_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">top_terms_overall</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>
        <span class="n">min_count_terms</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">ranking_terms</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes and organizes topics from the documents using specified parameters.</span>

<span class="sd">        This method uses a topic modeling process to identify and characterize topics within the data.</span>

<span class="sd">        Args:</span>
<span class="sd">            n_clusters (int): The number of clusters to form. Default is 5.</span>
<span class="sd">            ngrams (t.List[int]): The n-gram range to consider for topic extraction. Default is [1, 2].</span>
<span class="sd">            name_length (int): The length of the name for topics. Default is 10.</span>
<span class="sd">            top_terms_overall (int): The number of top terms to consider overall. Default is 2000.</span>
<span class="sd">            min_count_terms (int): The minimum count of terms to be considered. Default is 2.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: A DataFrame containing the topics and their associated data.</span>

<span class="sd">        Note:</span>
<span class="sd">            The method applies topic modeling using the specified parameters and updates the internal state</span>
<span class="sd">            with the resulting topics. It also associates the identified topics with the documents.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Add the conditional check for min_count_terms and len(self.docs)</span>
        <span class="k">if</span> <span class="n">min_count_terms</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">500</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;There is not enough data to select terms with a minimum occurrence of </span><span class="si">{</span><span class="n">min_count_terms</span><span class="si">}</span><span class="s2">. Setting min_count_terms to 1&quot;</span>
            <span class="p">)</span>
            <span class="n">min_count_terms</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Computing the topics&quot;</span><span class="p">)</span>

        <span class="n">topic_model</span> <span class="o">=</span> <span class="n">BunkaTopicModeling</span><span class="p">(</span>
            <span class="n">n_clusters</span><span class="o">=</span><span class="n">n_clusters</span><span class="p">,</span>
            <span class="n">ngrams</span><span class="o">=</span><span class="n">ngrams</span><span class="p">,</span>
            <span class="n">name_length</span><span class="o">=</span><span class="n">name_length</span><span class="p">,</span>
            <span class="n">x_column</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
            <span class="n">y_column</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span>
            <span class="n">top_terms_overall</span><span class="o">=</span><span class="n">top_terms_overall</span><span class="p">,</span>
            <span class="n">min_count_terms</span><span class="o">=</span><span class="n">min_count_terms</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">Topic</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span>
            <span class="n">docs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">,</span>
            <span class="n">terms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">terms</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">model_ranker</span> <span class="o">=</span> <span class="n">DocumentRanker</span><span class="p">(</span><span class="n">ranking_terms</span><span class="o">=</span><span class="n">ranking_terms</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics</span> <span class="o">=</span> <span class="n">model_ranker</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df_topics_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_top_docs_per_topic_</span> <span class="o">=</span> <span class="n">_create_topic_dfs</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_topics_</span>

    <span class="k">def</span> <span class="nf">get_clean_topic_name</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">llm</span><span class="p">,</span>
        <span class="n">language</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;english&quot;</span><span class="p">,</span>
        <span class="n">use_doc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;everything&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enhances topic names using a language model for cleaner and more meaningful representations.</span>

<span class="sd">        Args:</span>
<span class="sd">            llm: The language model used for cleaning topic names.</span>
<span class="sd">            language (str): The language context for the language model. Default is &quot;english&quot;.</span>
<span class="sd">            use_doc (bool): Flag to determine whether to use document context in the cleaning process. Default is False.</span>
<span class="sd">            context (str): The broader context within which the topics are related Default is &quot;everything&quot;. For instance, if you are looking at Computer Science, then update context = &#39;Computer Science&#39;</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: A DataFrame containing the topics with cleaned names.</span>

<span class="sd">        Note:</span>
<span class="sd">            This method leverages a language model to refine the names of the topics generated by the model,</span>
<span class="sd">            aiming for more understandable and relevant topic descriptors.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using LLM to make topic names cleaner&quot;</span><span class="p">)</span>

        <span class="n">model_cleaning</span> <span class="o">=</span> <span class="n">LLMCleaningTopic</span><span class="p">(</span>
            <span class="n">llm</span><span class="p">,</span>
            <span class="n">language</span><span class="o">=</span><span class="n">language</span><span class="p">,</span>
            <span class="n">use_doc</span><span class="o">=</span><span class="n">use_doc</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">Topic</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_cleaning</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df_topics_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_top_docs_per_topic_</span> <span class="o">=</span> <span class="n">_create_topic_dfs</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_topics_</span>

    <span class="k">def</span> <span class="nf">visualize_topics</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">show_text</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">label_size_ratio</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">colorscale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;delta&quot;</span><span class="p">,</span>
        <span class="n">density</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">convex_hull</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a visualization of the identified topics in the document set.</span>

<span class="sd">        Args:</span>
<span class="sd">            show_text (bool): Whether to display text labels on the visualization. Default is True.</span>
<span class="sd">            label_size_ratio (int): The size ratio of the labels in the visualization. Default is 100.</span>
<span class="sd">            width (int): The width of the visualization figure. Default is 1000.</span>
<span class="sd">            height (int): The height of the visualization figure. Default is 1000.</span>
<span class="sd">            colorscale (str): colorscale for the Density Plot (Default is delta)</span>
<span class="sd">            density (bool): Whether to display a density map</span>
<span class="sd">            convex_hull (bool): Whether to display lines around the clusters</span>

<span class="sd">        Returns:</span>
<span class="sd">            go.Figure: A Plotly graph object figure representing the topic visualization.</span>

<span class="sd">        Note:</span>
<span class="sd">            This method creates a &#39;Bunka Map&#39;, a graphical representation of the topics,</span>
<span class="sd">            using Plotly for interactive visualization. It displays how documents are grouped</span>
<span class="sd">            into topics and can include text labels for clarity.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating the Bunka Map&quot;</span><span class="p">)</span>

        <span class="n">model_visualizer</span> <span class="o">=</span> <span class="n">TopicVisualizer</span><span class="p">(</span>
            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
            <span class="n">show_text</span><span class="o">=</span><span class="n">show_text</span><span class="p">,</span>
            <span class="n">label_size_ratio</span><span class="o">=</span><span class="n">label_size_ratio</span><span class="p">,</span>
            <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span>
            <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span>
            <span class="n">convex_hull</span><span class="o">=</span><span class="n">convex_hull</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">model_visualizer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span>

    <span class="k">def</span> <span class="nf">visualize_bourdieu</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">llm</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">x_left_words</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;war&quot;</span><span class="p">],</span>
        <span class="n">x_right_words</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;peace&quot;</span><span class="p">],</span>
        <span class="n">y_top_words</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;men&quot;</span><span class="p">],</span>
        <span class="n">y_bottom_words</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;women&quot;</span><span class="p">],</span>
        <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">,</span>
        <span class="n">display_percent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">clustering</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">topic_n_clusters</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">topic_terms</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">topic_ngrams</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="n">topic_top_terms_overall</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">gen_topic_language</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;english&quot;</span><span class="p">,</span>
        <span class="n">topic_gen_name</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">manual_axis_name</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_doc_gen_topic</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">radius_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
        <span class="n">convex_hull</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">density</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">colorscale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;delta&quot;</span><span class="p">,</span>
        <span class="n">label_size_ratio_clusters</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">label_size_ratio_label</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">label_size_ratio_percent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates and visualizes a Bourdieu Map using specified parameters and a generative model.</span>

<span class="sd">        Args:</span>
<span class="sd">            generative_model (t.Optional[str]): The generative model to be used. Default is None.</span>
<span class="sd">            x_left_words, x_right_words (t.List[str]): Words defining the left and right axes.</span>
<span class="sd">            y_top_words, y_bottom_words (t.List[str]): Words defining the top and bottom axes.</span>
<span class="sd">            height, width (int): Dimensions of the visualization. Both default to 1500.</span>
<span class="sd">            display_percent (bool): Flag to display percentages on the map. Default is True.</span>
<span class="sd">            clustering (bool): Whether to apply clustering on the map. Default is False.</span>
<span class="sd">            topic_n_clusters (int): Number of clusters for topic modeling. Default is 10.</span>
<span class="sd">            topic_terms (int): Length of topic names. Default is 2.</span>
<span class="sd">            topic_ngrams (t.List[int]): N-gram range for topic modeling. Default is [1, 2].</span>
<span class="sd">            topic_top_terms_overall (int): Top terms to consider overall. Default is 1000.</span>
<span class="sd">            gen_topic_language (str): Language for topic generation. Default is &quot;english&quot;.</span>
<span class="sd">            topic_gen_name (bool): Flag to generate topic names. Default is False.</span>
<span class="sd">            manual_axis_name (t.Optional[dict]): Custom axis names for the map. Default is None.</span>
<span class="sd">            use_doc_gen_topic (bool): Flag to use document context in topic generation. Default is False.</span>
<span class="sd">            radius_size (float): Radius size for the map isualization. Default is 0.3.</span>
<span class="sd">            convex_hull (bool): Whether to include a convex hull in the visualization. Default is True.</span>
<span class="sd">            colorscale (str): colorscale for the Density Plot (Default is delta)</span>
<span class="sd">            density (bool): Whether to display a density map</span>


<span class="sd">            Returns:</span>
<span class="sd">                go.Figure: A Plotly graph object figure representing the Bourdieu Map.</span>

<span class="sd">        Note:</span>
<span class="sd">            The Bourdieu Map is a sophisticated visualization that plots documents and topics</span>
<span class="sd">            based on specified word axes, using a generative model for dynamic analysis.</span>
<span class="sd">            This method handles the complex process of generating and plotting this map,</span>
<span class="sd">            offering a range of customization options for detailed analysis.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating the Bourdieu Map&quot;</span><span class="p">)</span>
        <span class="n">topic_gen_param</span> <span class="o">=</span> <span class="n">TopicGenParam</span><span class="p">(</span>
            <span class="n">language</span><span class="o">=</span><span class="n">gen_topic_language</span><span class="p">,</span>
            <span class="n">top_doc</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">top_terms</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">use_doc</span><span class="o">=</span><span class="n">use_doc_gen_topic</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="s2">&quot;everything&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">topic_param</span> <span class="o">=</span> <span class="n">TopicParam</span><span class="p">(</span>
            <span class="n">n_clusters</span><span class="o">=</span><span class="n">topic_n_clusters</span><span class="p">,</span>
            <span class="n">ngrams</span><span class="o">=</span><span class="n">topic_ngrams</span><span class="p">,</span>
            <span class="n">name_lenght</span><span class="o">=</span><span class="n">topic_terms</span><span class="p">,</span>
            <span class="n">top_terms_overall</span><span class="o">=</span><span class="n">topic_top_terms_overall</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bourdieu_query</span> <span class="o">=</span> <span class="n">BourdieuQuery</span><span class="p">(</span>
            <span class="n">x_left_words</span><span class="o">=</span><span class="n">x_left_words</span><span class="p">,</span>
            <span class="n">x_right_words</span><span class="o">=</span><span class="n">x_right_words</span><span class="p">,</span>
            <span class="n">y_top_words</span><span class="o">=</span><span class="n">y_top_words</span><span class="p">,</span>
            <span class="n">y_bottom_words</span><span class="o">=</span><span class="n">y_bottom_words</span><span class="p">,</span>
            <span class="n">radius_size</span><span class="o">=</span><span class="n">radius_size</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Request Bourdieu API</span>

        <span class="n">bourdieu_api</span> <span class="o">=</span> <span class="n">BourdieuAPI</span><span class="p">(</span>
            <span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
            <span class="n">embedding_model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span>
            <span class="n">bourdieu_query</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bourdieu_query</span><span class="p">,</span>
            <span class="n">generative_ai_name</span><span class="o">=</span><span class="n">topic_gen_name</span><span class="p">,</span>
            <span class="n">topic_param</span><span class="o">=</span><span class="n">topic_param</span><span class="p">,</span>
            <span class="n">topic_gen_param</span><span class="o">=</span><span class="n">topic_gen_param</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">new_docs</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">)</span>
        <span class="n">new_terms</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">terms</span><span class="p">)</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">bourdieu_api</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span>
            <span class="n">docs</span><span class="o">=</span><span class="n">new_docs</span><span class="p">,</span>
            <span class="n">terms</span><span class="o">=</span><span class="n">new_terms</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bourdieu_docs</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bourdieu_topics</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">visualizer</span> <span class="o">=</span> <span class="n">BourdieuVisualizer</span><span class="p">(</span>
            <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
            <span class="n">display_percent</span><span class="o">=</span><span class="n">display_percent</span><span class="p">,</span>
            <span class="n">convex_hull</span><span class="o">=</span><span class="n">convex_hull</span><span class="p">,</span>
            <span class="n">clustering</span><span class="o">=</span><span class="n">clustering</span><span class="p">,</span>
            <span class="n">manual_axis_name</span><span class="o">=</span><span class="n">manual_axis_name</span><span class="p">,</span>
            <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span>
            <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span>
            <span class="n">label_size_ratio_clusters</span><span class="o">=</span><span class="n">label_size_ratio_clusters</span><span class="p">,</span>
            <span class="n">label_size_ratio_label</span><span class="o">=</span><span class="n">label_size_ratio_label</span><span class="p">,</span>
            <span class="n">label_size_ratio_percent</span><span class="o">=</span><span class="n">label_size_ratio_percent</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">visualizer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bourdieu_docs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bourdieu_topics</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span>

    <span class="k">def</span> <span class="nf">rag_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">llm</span><span class="p">,</span> <span class="n">top_doc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes a Retrieve-and-Generate (RAG) query using the provided language model and document set.</span>

<span class="sd">        Args:</span>
<span class="sd">            query (str): The query string to be processed.</span>
<span class="sd">            llm: The language model used for generating answers.</span>
<span class="sd">            top_doc (int): The number of top documents to retrieve for the query. Default is 2.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The response from the RAG query, including the answer and source documents.</span>

<span class="sd">        Note:</span>
<span class="sd">            This method utilizes a RetrievalQA chain to answer queries. It retrieves relevant documents</span>
<span class="sd">            based on the query and uses the language model to generate a response. The method is designed</span>
<span class="sd">            to work with complex queries and provide informative answers using the document set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Log a message indicating the query is being processed</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Answering your query, please wait a few seconds&quot;</span><span class="p">)</span>

        <span class="c1"># Create a RetrievalQA instance with the specified llm and retriever</span>
        <span class="n">qa_with_sources_chain</span> <span class="o">=</span> <span class="n">RetrievalQA</span><span class="o">.</span><span class="n">from_chain_type</span><span class="p">(</span>
            <span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
            <span class="n">retriever</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vectorstore</span><span class="o">.</span><span class="n">as_retriever</span><span class="p">(</span><span class="n">search_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;k&quot;</span><span class="p">:</span> <span class="n">top_doc</span><span class="p">}),</span>
            <span class="n">return_source_documents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Include source documents in the response</span>
        <span class="p">)</span>

        <span class="c1"># Provide the query to the RetrievalQA instance for answering</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">qa_with_sources_chain</span><span class="p">({</span><span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">})</span>

        <span class="k">return</span> <span class="n">response</span>

    <span class="k">def</span> <span class="nf">visualize_bourdieu_one_dimension</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">left</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;negative&quot;</span><span class="p">],</span>
        <span class="n">right</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;positive&quot;</span><span class="p">],</span>
        <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>
        <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>
        <span class="n">explainer</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">t</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Visualizes the document set on a one-dimensional Bourdieu axis.</span>

<span class="sd">        Args:</span>
<span class="sd">            left (t.List[str]): List of words representing the left side of the axis.</span>
<span class="sd">            right (t.List[str]): List of words representing the right side of the axis.</span>
<span class="sd">            width (int): Width of the generated visualization. Default is 800.</span>
<span class="sd">            height (int): Height of the generated visualization. Default is 800.</span>
<span class="sd">            explainer (bool): Flag to include an explainer figure. Default is False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            t.Tuple[go.Figure, t.Union[plt.Figure, None]]: A tuple containing the main visualization figure</span>
<span class="sd">            and an optional explainer figure (if explainer is True).</span>

<span class="sd">        Note:</span>
<span class="sd">            This method creates a one-dimensional Bourdieu-style visualization, plotting documents along an</span>
<span class="sd">            axis defined by contrasting word sets. It helps in understanding the distribution of documents</span>
<span class="sd">            in terms of these contrasting word concepts. An optional explainer figure can provide additional</span>
<span class="sd">            insight into specific terms used in the visualization.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">model_bourdieu</span> <span class="o">=</span> <span class="n">BourdieuOneDimensionVisualizer</span><span class="p">(</span>
            <span class="n">embedding_model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span>
            <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span>
            <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
            <span class="n">explainer</span><span class="o">=</span><span class="n">explainer</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">model_bourdieu</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span>
            <span class="n">docs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span>

    <span class="k">def</span> <span class="nf">visualize_query</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">query</span><span class="o">=</span><span class="s2">&quot;What is America?&quot;</span><span class="p">,</span>
        <span class="n">min_score</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span>
        <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># Create a visualization plot using plot_query function</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">percent</span> <span class="o">=</span> <span class="n">plot_query</span><span class="p">(</span>
            <span class="n">embedding_model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span>
            <span class="n">docs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">,</span>
            <span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">,</span>
            <span class="n">min_score</span><span class="o">=</span><span class="n">min_score</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Return the visualization figure and percentage</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">percent</span>

    <span class="k">def</span> <span class="nf">visualize_dimensions</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dimensions</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;positive&quot;</span><span class="p">,</span> <span class="s2">&quot;negative&quot;</span><span class="p">,</span> <span class="s2">&quot;fear&quot;</span><span class="p">,</span> <span class="s2">&quot;love&quot;</span><span class="p">],</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">template</span><span class="o">=</span><span class="s2">&quot;plotly_dark&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Visualizes the similarity scores between a given query and the document set.</span>

<span class="sd">        Args:</span>
<span class="sd">            query (str): The query to be visualized against the documents. Default is &quot;What is America?&quot;.</span>
<span class="sd">            min_score (float): The minimum similarity score threshold for visualization. Default is 0.2.</span>
<span class="sd">            width (int): Width of the visualization. Default is 600.</span>
<span class="sd">            height (int): Height of the visualization. Default is 300.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple (fig, percent) where &#39;fig&#39; is a Plotly graph object figure representing the</span>
<span class="sd">            visualization and &#39;percent&#39; is the percentage of documents above the similarity threshold.</span>

<span class="sd">        Note:</span>
<span class="sd">            This method creates a visualization showing how closely documents in the set relate to</span>
<span class="sd">            the specified query. Documents with similarity scores above the threshold are highlighted,</span>
<span class="sd">            providing a visual representation of their relevance to the query.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">final_df</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Computing Similarities&quot;</span><span class="p">)</span>
        <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">(</span><span class="n">feature_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">dimensions</span><span class="p">):</span>
            <span class="n">df_search</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>
            <span class="n">df_search</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorstore</span><span class="o">.</span><span class="n">similarity_search_with_score</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">df_search</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span>
                <span class="n">df_search</span><span class="p">[[</span><span class="s2">&quot;cosine_similarity_score&quot;</span><span class="p">]]</span>
            <span class="p">)</span>
            <span class="n">df_search</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dim</span>
            <span class="n">final_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_search</span><span class="p">)</span>
        <span class="n">final_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">final_df</span><span class="p">])</span>

        <span class="n">final_df_mean</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">final_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">)[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span>
            <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;mean_score&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">final_df_mean</span> <span class="o">=</span> <span class="n">final_df_mean</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
            <span class="s2">&quot;mean_score&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">final_df_mean</span><span class="p">[</span><span class="s2">&quot;rank&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_df_mean</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df_dimensions</span> <span class="o">=</span> <span class="n">final_df_mean</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">line_polar</span><span class="p">(</span>
            <span class="n">final_df_mean</span><span class="p">,</span>
            <span class="n">r</span><span class="o">=</span><span class="s2">&quot;mean_score&quot;</span><span class="p">,</span>
            <span class="n">theta</span><span class="o">=</span><span class="s2">&quot;source&quot;</span><span class="p">,</span>
            <span class="n">line_close</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">template</span><span class="o">=</span><span class="n">template</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span>

    <span class="k">def</span> <span class="nf">get_topic_repartition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">800</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a bar plot to visualize the distribution of topics by size.</span>

<span class="sd">        Args:</span>
<span class="sd">            width (int): The width of the bar plot. Default is 1200.</span>
<span class="sd">            height (int): The height of the bar plot. Default is 800.</span>

<span class="sd">        Returns:</span>
<span class="sd">            go.Figure: A Plotly graph object figure representing the topic distribution bar plot.</span>

<span class="sd">        Note:</span>
<span class="sd">            This method generates a visualization that illustrates the number of documents</span>
<span class="sd">            associated with each topic, helping to understand the prevalence and distribution</span>
<span class="sd">            of topics within the document set. It provides a clear and concise bar plot for</span>
<span class="sd">            easy interpretation of the topic sizes.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">get_topic_repartition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span>

    <span class="k">def</span> <span class="nf">get_topic_coherence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic_terms_n</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">texts</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span><span class="o">.</span><span class="n">term_id</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">get_coherence</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="p">,</span> <span class="n">texts</span><span class="p">,</span> <span class="n">topic_terms_n</span><span class="o">=</span><span class="n">topic_terms_n</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span> <span class="nf">clean_data_by_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Filters and cleans the dataset based on user-selected topics.</span>

<span class="sd">        This method presents a UI with checkboxes for each topic in the dataset.</span>
<span class="sd">        The user can select topics to keep, and the data will be filtered accordingly.</span>
<span class="sd">        It merges the filtered documents and topics data, renames columns for clarity,</span>
<span class="sd">        and calculates the percentage of data retained after cleaning.</span>

<span class="sd">        Attributes Updated:</span>
<span class="sd">            - self.df_cleaned: DataFrame containing the merged and cleaned documents and topics.</span>

<span class="sd">        Logging:</span>
<span class="sd">            - Logs the percentage of data retained after cleaning.</span>

<span class="sd">        Side Effects:</span>
<span class="sd">            - Updates `self.df_cleaned` with the cleaned data.</span>
<span class="sd">            - Displays interactive widgets for user input.</span>
<span class="sd">            - Logs information about the data cleaning process.</span>

<span class="sd">        Note:</span>
<span class="sd">            - This method uses interactive widgets (checkboxes and a button) for user input.</span>
<span class="sd">            - The cleaning process is triggered by clicking the &#39;Clean Data&#39; button.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">on_button_clicked</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="n">selected_topics</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">checkbox</span><span class="o">.</span><span class="n">description</span> <span class="k">for</span> <span class="n">checkbox</span> <span class="ow">in</span> <span class="n">checkboxes</span> <span class="k">if</span> <span class="n">checkbox</span><span class="o">.</span><span class="n">value</span>
            <span class="p">]</span>
            <span class="n">topic_filtered</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">selected_topics</span><span class="p">]</span>
            <span class="n">topic_id_filtered</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">topic_id</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">topic_filtered</span><span class="p">]</span>
            <span class="n">docs_filtered</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">topic_id</span> <span class="ow">in</span> <span class="n">topic_id_filtered</span><span class="p">]</span>

            <span class="n">df_docs_cleaned</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">doc</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs_filtered</span><span class="p">])</span>
            <span class="n">df_docs_cleaned</span> <span class="o">=</span> <span class="n">df_docs_cleaned</span><span class="p">[[</span><span class="s2">&quot;doc_id&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;topic_id&quot;</span><span class="p">]]</span>
            <span class="n">df_topics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">topic</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">topic_filtered</span><span class="p">])</span>
            <span class="n">df_topics</span> <span class="o">=</span> <span class="n">df_topics</span><span class="p">[[</span><span class="s2">&quot;topic_id&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df_cleaned_</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_docs_cleaned</span><span class="p">,</span> <span class="n">df_topics</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;topic_id&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df_cleaned_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_cleaned_</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;topic_name&quot;</span><span class="p">})</span>

            <span class="n">len_kept</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">docs_filtered</span><span class="p">)</span>
            <span class="n">len_docs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">)</span>
            <span class="n">percent_kept</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">len_kept</span> <span class="o">/</span> <span class="n">len_docs</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
            <span class="n">percent_kept</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">percent_kept</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;After cleaning, you&#39;ve kept </span><span class="si">{</span><span class="n">percent_kept</span><span class="si">}</span><span class="s2"> of your data&quot;</span><span class="p">)</span>

        <span class="c1"># Optionally, return or display df_cleaned</span>
        <span class="n">topic_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="p">]</span>
        <span class="n">checkboxes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Checkbox</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">topic_names</span>
        <span class="p">]</span>

        <span class="n">title_label</span> <span class="o">=</span> <span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Click on the topics you want to remove &quot;</span><span class="p">)</span>
        <span class="n">checkbox_container</span> <span class="o">=</span> <span class="n">VBox</span><span class="p">(</span>
            <span class="p">[</span><span class="n">title_label</span><span class="p">]</span> <span class="o">+</span> <span class="n">checkboxes</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="n">overflow</span><span class="o">=</span><span class="s2">&quot;scroll hidden&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">button</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Clean Data&quot;</span><span class="p">,</span>
            <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;button_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#2596be&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#2596be&quot;</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="n">button</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="n">on_button_clicked</span><span class="p">)</span>
        <span class="n">display</span><span class="p">(</span><span class="n">checkbox_container</span><span class="p">,</span> <span class="n">button</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">manually_clean_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Allows manual renaming of topic names in the dataset.</span>

<span class="sd">        This method facilitates the manual editing of topic names based on their IDs.</span>
<span class="sd">        If no changes are made, it retains the original topic names.</span>

<span class="sd">        The updated topic names are then applied to the `topics` attribute of the class instance.</span>

<span class="sd">        Attributes Updated:</span>
<span class="sd">            - self.topics: Each topic in this list gets its name updated based on the changes.</span>

<span class="sd">        Logging:</span>
<span class="sd">            - Logs the percentage of data retained after cleaning.</span>

<span class="sd">        Side Effects:</span>
<span class="sd">            - Modifies the `name` attribute of each topic in `self.topics` based on user input or defaults.</span>
<span class="sd">            - Displays interactive widgets for user input.</span>
<span class="sd">            - Logs information about the data cleaning process.</span>

<span class="sd">        Note:</span>
<span class="sd">            - This method uses interactive widgets (text fields and a button) for user input.</span>
<span class="sd">            - The cleaning process is triggered by clicking the &#39;Apply Changes&#39; button.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">apply_changes</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">text_widget</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">text_widgets</span><span class="p">):</span>
                <span class="n">new_name</span> <span class="o">=</span> <span class="n">text_widget</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">new_name</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">new_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">original_topic_names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>  <span class="c1"># Keep the same name</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_name</span><span class="p">)</span>

            <span class="c1"># Log changes applied</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Changes Applied!&quot;</span><span class="p">)</span>

            <span class="c1"># Update the topic names</span>
            <span class="n">topic_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">original_topic_ids</span><span class="p">,</span> <span class="n">new_names</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="p">:</span>
                <span class="n">topic</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">topic_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">topic</span><span class="o">.</span><span class="n">topic_id</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">df_topics_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_top_docs_per_topic_</span> <span class="o">=</span> <span class="n">_create_topic_dfs</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span>
            <span class="p">)</span>

        <span class="n">original_topic_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="p">]</span>
        <span class="n">original_topic_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">topic_id</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="p">]</span>
        <span class="n">new_names</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Create a list of Text widgets for entering new names with IDs as descriptions</span>
        <span class="n">text_widgets</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">topic_id</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span><span class="n">original_topic_names</span><span class="p">,</span> <span class="n">original_topic_ids</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">text_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">topic</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">topic_id</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
            <span class="n">text_widgets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text_widget</span><span class="p">)</span>

        <span class="c1"># Create a title widget</span>
        <span class="n">title_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="s2">&quot;Manually input the new topic names: &quot;</span><span class="p">)</span>

        <span class="c1"># Combine the title, Text widgets, and a button in a VBox</span>
        <span class="n">container</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="n">title_widget</span><span class="p">]</span> <span class="o">+</span> <span class="n">text_widgets</span><span class="p">)</span>

        <span class="c1"># Create a button to apply changes with text color #2596be and bold description</span>
        <span class="n">apply_button</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Apply Changes&quot;</span><span class="p">,</span>
            <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;button_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#2596be&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#2596be&quot;</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="n">apply_button</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="n">apply_changes</span><span class="p">)</span>

        <span class="c1"># Display the container and apply button</span>
        <span class="n">display</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">apply_button</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">start_server_bourdieu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">is_server_running</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Server on port 3000 is already running. Killing it...&quot;</span><span class="p">)</span>
            <span class="n">kill_server</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="s2">&quot;../web/public&quot;</span> <span class="o">+</span> <span class="s2">&quot;/bunka_bourdieu_docs.json&quot;</span>
            <span class="n">docs_json</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bourdieu_docs</span><span class="p">]</span>
            <span class="n">docs_json</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bourdieu_docs</span><span class="p">]</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">docs_json</span><span class="p">,</span> <span class="n">json_file</span><span class="p">)</span>

            <span class="n">file_path</span> <span class="o">=</span> <span class="s2">&quot;../web/public&quot;</span> <span class="o">+</span> <span class="s2">&quot;/bunka_bourdieu_topics.json&quot;</span>
            <span class="n">topics_json</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bourdieu_topics</span><span class="p">]</span>
            <span class="n">topics_json</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bourdieu_topics</span><span class="p">]</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">topics_json</span><span class="p">,</span> <span class="n">json_file</span><span class="p">)</span>

            <span class="n">file_path</span> <span class="o">=</span> <span class="s2">&quot;../web/public&quot;</span> <span class="o">+</span> <span class="s2">&quot;/bunka_bourdieu_query.json&quot;</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bourdieu_query</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(),</span> <span class="n">json_file</span><span class="p">)</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bourdieu_query</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(),</span> <span class="n">json_file</span><span class="p">)</span>

            <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s2">&quot;npm&quot;</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">cwd</span><span class="o">=</span><span class="s2">&quot;../web&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;NPM server started. Please Switch to Bourdieu View to see the results&quot;</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error starting NPM server: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">start_server</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">is_server_running</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Server on port 3000 is already running. Killing it...&quot;</span><span class="p">)</span>
            <span class="n">kill_server</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="s2">&quot;../web/public&quot;</span> <span class="o">+</span> <span class="s2">&quot;/bunka_docs.json&quot;</span>
            <span class="n">docs_json</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">]</span>
            <span class="n">docs_json</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">]</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">docs_json</span><span class="p">,</span> <span class="n">json_file</span><span class="p">)</span>

            <span class="n">file_path</span> <span class="o">=</span> <span class="s2">&quot;../web/public&quot;</span> <span class="o">+</span> <span class="s2">&quot;/bunka_topics.json&quot;</span>
            <span class="n">topics_json</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="p">]</span>
            <span class="n">topics_json</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="p">]</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">topics_json</span><span class="p">,</span> <span class="n">json_file</span><span class="p">)</span>

            <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s2">&quot;npm&quot;</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">cwd</span><span class="o">=</span><span class="s2">&quot;../web&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;NPM server started.&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error starting NPM server: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h2 id="bunkatopics._bunkatopics.Bunka.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">embedding_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="s1">&#39;english&#39;</span><span class="p">)</span></code>

<a href="#bunkatopics._bunkatopics.Bunka.__init__" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Initialize a BunkaTopics instance.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>embedding_model</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An optional embedding model for generating document embeddings.
 If not provided, a default model will be used based on the specified language.
 Default: None</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>language</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The language to be used for text processing and modeling.
 Options: "english" (default), or specify another language as needed.
 Default: "english"</p>
            </div>
          </td>
          <td>
                <code>&#39;english&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>bunkatopics/_bunkatopics.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">embedding_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">language</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;english&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize a BunkaTopics instance.</span>

<span class="sd">    Arguments:</span>
<span class="sd">       embedding_model : An optional embedding model for generating document embeddings.</span>
<span class="sd">           If not provided, a default model will be used based on the specified language.</span>
<span class="sd">           Default: None</span>
<span class="sd">       language : The language to be used for text processing and modeling.</span>
<span class="sd">           Options: &quot;english&quot; (default), or specify another language as needed.</span>
<span class="sd">           Default: &quot;english&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">LangChainDeprecationWarning</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">embedding_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">language</span> <span class="o">==</span> <span class="s2">&quot;english&quot;</span><span class="p">:</span>
            <span class="n">embedding_model</span> <span class="o">=</span> <span class="n">HuggingFaceEmbeddings</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;all-MiniLM-L6-v2&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">embedding_model</span> <span class="o">=</span> <span class="n">HuggingFaceEmbeddings</span><span class="p">(</span>
                <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;paraphrase-multilingual-MiniLM-L12-v2&quot;</span>
            <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">embedding_model</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">language</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">df_cleaned</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="bunkatopics._bunkatopics.Bunka.clean_data_by_topics" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">clean_data_by_topics</span><span class="p">()</span></code>

<a href="#bunkatopics._bunkatopics.Bunka.clean_data_by_topics" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Filters and cleans the dataset based on user-selected topics.</p>
<p>This method presents a UI with checkboxes for each topic in the dataset.
The user can select topics to keep, and the data will be filtered accordingly.
It merges the filtered documents and topics data, renames columns for clarity,
and calculates the percentage of data retained after cleaning.</p>

<details class="attributes-updated" open>
  <summary>Attributes Updated</summary>
  <ul>
<li>self.df_cleaned: DataFrame containing the merged and cleaned documents and topics.</li>
</ul>
</details>
<details class="logging" open>
  <summary>Logging</summary>
  <ul>
<li>Logs the percentage of data retained after cleaning.</li>
</ul>
</details>
<details class="side-effects" open>
  <summary>Side Effects</summary>
  <ul>
<li>Updates <code>self.df_cleaned</code> with the cleaned data.</li>
<li>Displays interactive widgets for user input.</li>
<li>Logs information about the data cleaning process.</li>
</ul>
</details>
<details class="note" open>
  <summary>Note</summary>
  <ul>
<li>This method uses interactive widgets (checkboxes and a button) for user input.</li>
<li>The cleaning process is triggered by clicking the 'Clean Data' button.</li>
</ul>
</details>
          <details class="quote">
            <summary>Source code in <code>bunkatopics/_bunkatopics.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">clean_data_by_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Filters and cleans the dataset based on user-selected topics.</span>

<span class="sd">    This method presents a UI with checkboxes for each topic in the dataset.</span>
<span class="sd">    The user can select topics to keep, and the data will be filtered accordingly.</span>
<span class="sd">    It merges the filtered documents and topics data, renames columns for clarity,</span>
<span class="sd">    and calculates the percentage of data retained after cleaning.</span>

<span class="sd">    Attributes Updated:</span>
<span class="sd">        - self.df_cleaned: DataFrame containing the merged and cleaned documents and topics.</span>

<span class="sd">    Logging:</span>
<span class="sd">        - Logs the percentage of data retained after cleaning.</span>

<span class="sd">    Side Effects:</span>
<span class="sd">        - Updates `self.df_cleaned` with the cleaned data.</span>
<span class="sd">        - Displays interactive widgets for user input.</span>
<span class="sd">        - Logs information about the data cleaning process.</span>

<span class="sd">    Note:</span>
<span class="sd">        - This method uses interactive widgets (checkboxes and a button) for user input.</span>
<span class="sd">        - The cleaning process is triggered by clicking the &#39;Clean Data&#39; button.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">on_button_clicked</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
        <span class="n">selected_topics</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">checkbox</span><span class="o">.</span><span class="n">description</span> <span class="k">for</span> <span class="n">checkbox</span> <span class="ow">in</span> <span class="n">checkboxes</span> <span class="k">if</span> <span class="n">checkbox</span><span class="o">.</span><span class="n">value</span>
        <span class="p">]</span>
        <span class="n">topic_filtered</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">selected_topics</span><span class="p">]</span>
        <span class="n">topic_id_filtered</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">topic_id</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">topic_filtered</span><span class="p">]</span>
        <span class="n">docs_filtered</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">topic_id</span> <span class="ow">in</span> <span class="n">topic_id_filtered</span><span class="p">]</span>

        <span class="n">df_docs_cleaned</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">doc</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs_filtered</span><span class="p">])</span>
        <span class="n">df_docs_cleaned</span> <span class="o">=</span> <span class="n">df_docs_cleaned</span><span class="p">[[</span><span class="s2">&quot;doc_id&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;topic_id&quot;</span><span class="p">]]</span>
        <span class="n">df_topics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">topic</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">topic_filtered</span><span class="p">])</span>
        <span class="n">df_topics</span> <span class="o">=</span> <span class="n">df_topics</span><span class="p">[[</span><span class="s2">&quot;topic_id&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_cleaned_</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_docs_cleaned</span><span class="p">,</span> <span class="n">df_topics</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;topic_id&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_cleaned_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_cleaned_</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;topic_name&quot;</span><span class="p">})</span>

        <span class="n">len_kept</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">docs_filtered</span><span class="p">)</span>
        <span class="n">len_docs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">)</span>
        <span class="n">percent_kept</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">len_kept</span> <span class="o">/</span> <span class="n">len_docs</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="n">percent_kept</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">percent_kept</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;After cleaning, you&#39;ve kept </span><span class="si">{</span><span class="n">percent_kept</span><span class="si">}</span><span class="s2"> of your data&quot;</span><span class="p">)</span>

    <span class="c1"># Optionally, return or display df_cleaned</span>
    <span class="n">topic_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="p">]</span>
    <span class="n">checkboxes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">Checkbox</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">topic_names</span>
    <span class="p">]</span>

    <span class="n">title_label</span> <span class="o">=</span> <span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Click on the topics you want to remove &quot;</span><span class="p">)</span>
    <span class="n">checkbox_container</span> <span class="o">=</span> <span class="n">VBox</span><span class="p">(</span>
        <span class="p">[</span><span class="n">title_label</span><span class="p">]</span> <span class="o">+</span> <span class="n">checkboxes</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="n">overflow</span><span class="o">=</span><span class="s2">&quot;scroll hidden&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">button</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Clean Data&quot;</span><span class="p">,</span>
        <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;button_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#2596be&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#2596be&quot;</span><span class="p">},</span>
    <span class="p">)</span>
    <span class="n">button</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="n">on_button_clicked</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">checkbox_container</span><span class="p">,</span> <span class="n">button</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="bunkatopics._bunkatopics.Bunka.fit" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">ids</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#bunkatopics._bunkatopics.Bunka.fit" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Fits the Bunka model to the provided list of documents.</p>
<p>This method processes the documents, extracts terms, generates embeddings, and
applies dimensionality reduction to prepare the data for topic modeling.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>docs</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A list of document strings.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>ids</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="bunkatopics.datamodel.DOC_ID">DOC_ID</span>]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Optional. A list of identifiers for the documents. If not provided, UUIDs are generated.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>bunkatopics/_bunkatopics.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">docs</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">ids</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">DOC_ID</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fits the Bunka model to the provided list of documents.</span>

<span class="sd">    This method processes the documents, extracts terms, generates embeddings, and</span>
<span class="sd">    applies dimensionality reduction to prepare the data for topic modeling.</span>

<span class="sd">    Args:</span>
<span class="sd">        docs (t.List[str]): A list of document strings.</span>
<span class="sd">        ids (t.Optional[t.List[DOC_ID]]): Optional. A list of identifiers for the documents. If not provided, UUIDs are generated.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">])</span>

    <span class="c1"># Transform into a Document model</span>
    <span class="k">if</span> <span class="n">ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;doc_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ids</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;doc_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())[:</span><span class="mi">8</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Document</span><span class="p">(</span><span class="o">**</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="p">)]</span>
    <span class="n">sentences</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span><span class="o">.</span><span class="n">content</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">]</span>
    <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span><span class="o">.</span><span class="n">doc_id</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">]</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;Embedding documents... (can take varying amounts of time depending on their size)&quot;</span>
    <span class="p">)</span>

    <span class="n">characters</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span>
    <span class="n">random_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">characters</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>

    <span class="n">df_loader</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])</span>
    <span class="n">df_loader</span><span class="p">[</span><span class="s2">&quot;doc_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ids</span>

    <span class="n">loader</span> <span class="o">=</span> <span class="n">DataFrameLoader</span><span class="p">(</span><span class="n">df_loader</span><span class="p">,</span> <span class="n">page_content_column</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
    <span class="n">documents_langchain</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vectorstore</span> <span class="o">=</span> <span class="n">Chroma</span><span class="o">.</span><span class="n">from_documents</span><span class="p">(</span>
        <span class="n">documents_langchain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span> <span class="n">collection_name</span><span class="o">=</span><span class="n">random_string</span>
    <span class="p">)</span>

    <span class="n">bunka_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;doc_id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorstore</span><span class="o">.</span><span class="n">get</span><span class="p">()[</span><span class="s2">&quot;metadatas&quot;</span><span class="p">]]</span>
    <span class="n">bunka_docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorstore</span><span class="o">.</span><span class="n">get</span><span class="p">()[</span><span class="s2">&quot;documents&quot;</span><span class="p">]</span>
    <span class="n">bunka_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorstore</span><span class="o">.</span><span class="n">_collection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;embeddings&quot;</span><span class="p">])[</span>
        <span class="s2">&quot;embeddings&quot;</span>
    <span class="p">]</span>

    <span class="c1"># Add to the bunka objects</span>
    <span class="n">emb_doc_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bunka_ids</span><span class="p">,</span> <span class="n">bunka_embeddings</span><span class="p">)}</span>
    <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">:</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">embedding</span> <span class="o">=</span> <span class="n">emb_doc_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">doc_id</span><span class="p">,</span> <span class="p">[])</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Reducing the dimensions of embeddings...&quot;</span><span class="p">)</span>
    <span class="n">reducer</span> <span class="o">=</span> <span class="n">umap</span><span class="o">.</span><span class="n">UMAP</span><span class="p">(</span>
        <span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>  <span class="c1"># Not random state to go quicker</span>
    <span class="n">bunka_embeddings_2D</span> <span class="o">=</span> <span class="n">reducer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">bunka_embeddings</span><span class="p">)</span>
    <span class="n">df_embeddings_2D</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">bunka_embeddings_2D</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">])</span>
    <span class="n">df_embeddings_2D</span><span class="p">[</span><span class="s2">&quot;doc_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bunka_ids</span>
    <span class="n">df_embeddings_2D</span><span class="p">[</span><span class="s2">&quot;bunka_docs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bunka_docs</span>

    <span class="n">xy_dict</span> <span class="o">=</span> <span class="n">df_embeddings_2D</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;doc_id&quot;</span><span class="p">)[[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>

    <span class="c1"># Update the documents with the x and y values from the DataFrame</span>
    <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">:</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">xy_dict</span><span class="p">[</span><span class="n">doc</span><span class="o">.</span><span class="n">doc_id</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">]</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">xy_dict</span><span class="p">[</span><span class="n">doc</span><span class="o">.</span><span class="n">doc_id</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">df_embeddings_2D</span> <span class="o">=</span> <span class="n">df_embeddings_2D</span>

    <span class="c1"># Create a scatter plot</span>
    <span class="n">fig_quick_embedding</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_embeddings_2D</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">hover_data</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;bunka_docs&quot;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># Update layout for better readability</span>
    <span class="n">fig_quick_embedding</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Raw Scatter Plot of Bunka Embeddings&quot;</span><span class="p">,</span>
        <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;X Embedding&quot;</span><span class="p">,</span>
        <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Y Embedding&quot;</span><span class="p">,</span>
        <span class="n">hovermode</span><span class="o">=</span><span class="s2">&quot;closest&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># Show the plot</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fig_quick_embedding</span> <span class="o">=</span> <span class="n">fig_quick_embedding</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Extracting meaningful terms from documents...&quot;</span><span class="p">)</span>
    <span class="n">terms_extractor</span> <span class="o">=</span> <span class="n">TextacyTermsExtractor</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">terms</span><span class="p">,</span> <span class="n">indexed_terms_dict</span> <span class="o">=</span> <span class="n">terms_extractor</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">sentences</span><span class="p">)</span>

    <span class="c1"># add to the docs object</span>
    <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">:</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">term_id</span> <span class="o">=</span> <span class="n">indexed_terms_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">doc_id</span><span class="p">,</span> <span class="p">[])</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="bunkatopics._bunkatopics.Bunka.get_clean_topic_name" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_clean_topic_name</span><span class="p">(</span><span class="n">llm</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="s1">&#39;english&#39;</span><span class="p">,</span> <span class="n">use_doc</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;everything&#39;</span><span class="p">)</span></code>

<a href="#bunkatopics._bunkatopics.Bunka.get_clean_topic_name" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Enhances topic names using a language model for cleaner and more meaningful representations.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>llm</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The language model used for cleaning topic names.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>language</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The language context for the language model. Default is "english".</p>
            </div>
          </td>
          <td>
                <code>&#39;english&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>use_doc</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Flag to determine whether to use document context in the cleaning process. Default is False.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>context</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The broader context within which the topics are related Default is "everything". For instance, if you are looking at Computer Science, then update context = 'Computer Science'</p>
            </div>
          </td>
          <td>
                <code>&#39;everything&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>pd.DataFrame: A DataFrame containing the topics with cleaned names.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="note" open>
  <summary>Note</summary>
  <p>This method leverages a language model to refine the names of the topics generated by the model,
aiming for more understandable and relevant topic descriptors.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>bunkatopics/_bunkatopics.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_clean_topic_name</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">llm</span><span class="p">,</span>
    <span class="n">language</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;english&quot;</span><span class="p">,</span>
    <span class="n">use_doc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;everything&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enhances topic names using a language model for cleaner and more meaningful representations.</span>

<span class="sd">    Args:</span>
<span class="sd">        llm: The language model used for cleaning topic names.</span>
<span class="sd">        language (str): The language context for the language model. Default is &quot;english&quot;.</span>
<span class="sd">        use_doc (bool): Flag to determine whether to use document context in the cleaning process. Default is False.</span>
<span class="sd">        context (str): The broader context within which the topics are related Default is &quot;everything&quot;. For instance, if you are looking at Computer Science, then update context = &#39;Computer Science&#39;</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: A DataFrame containing the topics with cleaned names.</span>

<span class="sd">    Note:</span>
<span class="sd">        This method leverages a language model to refine the names of the topics generated by the model,</span>
<span class="sd">        aiming for more understandable and relevant topic descriptors.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using LLM to make topic names cleaner&quot;</span><span class="p">)</span>

    <span class="n">model_cleaning</span> <span class="o">=</span> <span class="n">LLMCleaningTopic</span><span class="p">(</span>
        <span class="n">llm</span><span class="p">,</span>
        <span class="n">language</span><span class="o">=</span><span class="n">language</span><span class="p">,</span>
        <span class="n">use_doc</span><span class="o">=</span><span class="n">use_doc</span><span class="p">,</span>
        <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">Topic</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_cleaning</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">df_topics_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_top_docs_per_topic_</span> <span class="o">=</span> <span class="n">_create_topic_dfs</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_topics_</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="bunkatopics._bunkatopics.Bunka.get_topic_repartition" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_topic_repartition</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span></code>

<a href="#bunkatopics._bunkatopics.Bunka.get_topic_repartition" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Creates a bar plot to visualize the distribution of topics by size.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>width</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The width of the bar plot. Default is 1200.</p>
            </div>
          </td>
          <td>
                <code>1200</code>
          </td>
        </tr>
        <tr>
          <td><code>height</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The height of the bar plot. Default is 800.</p>
            </div>
          </td>
          <td>
                <code>800</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="plotly.Figure">Figure</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>go.Figure: A Plotly graph object figure representing the topic distribution bar plot.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="note" open>
  <summary>Note</summary>
  <p>This method generates a visualization that illustrates the number of documents
associated with each topic, helping to understand the prevalence and distribution
of topics within the document set. It provides a clear and concise bar plot for
easy interpretation of the topic sizes.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>bunkatopics/_bunkatopics.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_topic_repartition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">800</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a bar plot to visualize the distribution of topics by size.</span>

<span class="sd">    Args:</span>
<span class="sd">        width (int): The width of the bar plot. Default is 1200.</span>
<span class="sd">        height (int): The height of the bar plot. Default is 800.</span>

<span class="sd">    Returns:</span>
<span class="sd">        go.Figure: A Plotly graph object figure representing the topic distribution bar plot.</span>

<span class="sd">    Note:</span>
<span class="sd">        This method generates a visualization that illustrates the number of documents</span>
<span class="sd">        associated with each topic, helping to understand the prevalence and distribution</span>
<span class="sd">        of topics within the document set. It provides a clear and concise bar plot for</span>
<span class="sd">        easy interpretation of the topic sizes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">get_topic_repartition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="bunkatopics._bunkatopics.Bunka.get_topics" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_topics</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">ngrams</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">name_length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">top_terms_overall</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">min_count_terms</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ranking_terms</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span></code>

<a href="#bunkatopics._bunkatopics.Bunka.get_topics" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Computes and organizes topics from the documents using specified parameters.</p>
<p>This method uses a topic modeling process to identify and characterize topics within the data.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>n_clusters</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The number of clusters to form. Default is 5.</p>
            </div>
          </td>
          <td>
                <code>5</code>
          </td>
        </tr>
        <tr>
          <td><code>ngrams</code></td>
          <td>
                <code><span title="typing.List">List</span>[int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The n-gram range to consider for topic extraction. Default is [1, 2].</p>
            </div>
          </td>
          <td>
                <code>[1, 2]</code>
          </td>
        </tr>
        <tr>
          <td><code>name_length</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The length of the name for topics. Default is 10.</p>
            </div>
          </td>
          <td>
                <code>5</code>
          </td>
        </tr>
        <tr>
          <td><code>top_terms_overall</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The number of top terms to consider overall. Default is 2000.</p>
            </div>
          </td>
          <td>
                <code>2000</code>
          </td>
        </tr>
        <tr>
          <td><code>min_count_terms</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The minimum count of terms to be considered. Default is 2.</p>
            </div>
          </td>
          <td>
                <code>2</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>pd.DataFrame: A DataFrame containing the topics and their associated data.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="note" open>
  <summary>Note</summary>
  <p>The method applies topic modeling using the specified parameters and updates the internal state
with the resulting topics. It also associates the identified topics with the documents.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>bunkatopics/_bunkatopics.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_topics</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">n_clusters</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">ngrams</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="n">name_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">top_terms_overall</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>
    <span class="n">min_count_terms</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">ranking_terms</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes and organizes topics from the documents using specified parameters.</span>

<span class="sd">    This method uses a topic modeling process to identify and characterize topics within the data.</span>

<span class="sd">    Args:</span>
<span class="sd">        n_clusters (int): The number of clusters to form. Default is 5.</span>
<span class="sd">        ngrams (t.List[int]): The n-gram range to consider for topic extraction. Default is [1, 2].</span>
<span class="sd">        name_length (int): The length of the name for topics. Default is 10.</span>
<span class="sd">        top_terms_overall (int): The number of top terms to consider overall. Default is 2000.</span>
<span class="sd">        min_count_terms (int): The minimum count of terms to be considered. Default is 2.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: A DataFrame containing the topics and their associated data.</span>

<span class="sd">    Note:</span>
<span class="sd">        The method applies topic modeling using the specified parameters and updates the internal state</span>
<span class="sd">        with the resulting topics. It also associates the identified topics with the documents.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Add the conditional check for min_count_terms and len(self.docs)</span>
    <span class="k">if</span> <span class="n">min_count_terms</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">500</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;There is not enough data to select terms with a minimum occurrence of </span><span class="si">{</span><span class="n">min_count_terms</span><span class="si">}</span><span class="s2">. Setting min_count_terms to 1&quot;</span>
        <span class="p">)</span>
        <span class="n">min_count_terms</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Computing the topics&quot;</span><span class="p">)</span>

    <span class="n">topic_model</span> <span class="o">=</span> <span class="n">BunkaTopicModeling</span><span class="p">(</span>
        <span class="n">n_clusters</span><span class="o">=</span><span class="n">n_clusters</span><span class="p">,</span>
        <span class="n">ngrams</span><span class="o">=</span><span class="n">ngrams</span><span class="p">,</span>
        <span class="n">name_length</span><span class="o">=</span><span class="n">name_length</span><span class="p">,</span>
        <span class="n">x_column</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
        <span class="n">y_column</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span>
        <span class="n">top_terms_overall</span><span class="o">=</span><span class="n">top_terms_overall</span><span class="p">,</span>
        <span class="n">min_count_terms</span><span class="o">=</span><span class="n">min_count_terms</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">Topic</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span>
        <span class="n">docs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">,</span>
        <span class="n">terms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">terms</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">model_ranker</span> <span class="o">=</span> <span class="n">DocumentRanker</span><span class="p">(</span><span class="n">ranking_terms</span><span class="o">=</span><span class="n">ranking_terms</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics</span> <span class="o">=</span> <span class="n">model_ranker</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">df_topics_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_top_docs_per_topic_</span> <span class="o">=</span> <span class="n">_create_topic_dfs</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_topics_</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="bunkatopics._bunkatopics.Bunka.manually_clean_topics" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">manually_clean_topics</span><span class="p">()</span></code>

<a href="#bunkatopics._bunkatopics.Bunka.manually_clean_topics" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Allows manual renaming of topic names in the dataset.</p>
<p>This method facilitates the manual editing of topic names based on their IDs.
If no changes are made, it retains the original topic names.</p>
<p>The updated topic names are then applied to the <code>topics</code> attribute of the class instance.</p>

<details class="attributes-updated" open>
  <summary>Attributes Updated</summary>
  <ul>
<li>self.topics: Each topic in this list gets its name updated based on the changes.</li>
</ul>
</details>
<details class="logging" open>
  <summary>Logging</summary>
  <ul>
<li>Logs the percentage of data retained after cleaning.</li>
</ul>
</details>
<details class="side-effects" open>
  <summary>Side Effects</summary>
  <ul>
<li>Modifies the <code>name</code> attribute of each topic in <code>self.topics</code> based on user input or defaults.</li>
<li>Displays interactive widgets for user input.</li>
<li>Logs information about the data cleaning process.</li>
</ul>
</details>
<details class="note" open>
  <summary>Note</summary>
  <ul>
<li>This method uses interactive widgets (text fields and a button) for user input.</li>
<li>The cleaning process is triggered by clicking the 'Apply Changes' button.</li>
</ul>
</details>
          <details class="quote">
            <summary>Source code in <code>bunkatopics/_bunkatopics.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">manually_clean_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Allows manual renaming of topic names in the dataset.</span>

<span class="sd">    This method facilitates the manual editing of topic names based on their IDs.</span>
<span class="sd">    If no changes are made, it retains the original topic names.</span>

<span class="sd">    The updated topic names are then applied to the `topics` attribute of the class instance.</span>

<span class="sd">    Attributes Updated:</span>
<span class="sd">        - self.topics: Each topic in this list gets its name updated based on the changes.</span>

<span class="sd">    Logging:</span>
<span class="sd">        - Logs the percentage of data retained after cleaning.</span>

<span class="sd">    Side Effects:</span>
<span class="sd">        - Modifies the `name` attribute of each topic in `self.topics` based on user input or defaults.</span>
<span class="sd">        - Displays interactive widgets for user input.</span>
<span class="sd">        - Logs information about the data cleaning process.</span>

<span class="sd">    Note:</span>
<span class="sd">        - This method uses interactive widgets (text fields and a button) for user input.</span>
<span class="sd">        - The cleaning process is triggered by clicking the &#39;Apply Changes&#39; button.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">apply_changes</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">text_widget</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">text_widgets</span><span class="p">):</span>
            <span class="n">new_name</span> <span class="o">=</span> <span class="n">text_widget</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">new_name</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">new_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">original_topic_names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>  <span class="c1"># Keep the same name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_name</span><span class="p">)</span>

        <span class="c1"># Log changes applied</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Changes Applied!&quot;</span><span class="p">)</span>

        <span class="c1"># Update the topic names</span>
        <span class="n">topic_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">original_topic_ids</span><span class="p">,</span> <span class="n">new_names</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="p">:</span>
            <span class="n">topic</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">topic_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">topic</span><span class="o">.</span><span class="n">topic_id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df_topics_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_top_docs_per_topic_</span> <span class="o">=</span> <span class="n">_create_topic_dfs</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span>
        <span class="p">)</span>

    <span class="n">original_topic_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="p">]</span>
    <span class="n">original_topic_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">topic_id</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="p">]</span>
    <span class="n">new_names</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Create a list of Text widgets for entering new names with IDs as descriptions</span>
    <span class="n">text_widgets</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">topic_id</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
        <span class="nb">zip</span><span class="p">(</span><span class="n">original_topic_names</span><span class="p">,</span> <span class="n">original_topic_ids</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="n">text_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">topic</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">topic_id</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
        <span class="n">text_widgets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text_widget</span><span class="p">)</span>

    <span class="c1"># Create a title widget</span>
    <span class="n">title_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="s2">&quot;Manually input the new topic names: &quot;</span><span class="p">)</span>

    <span class="c1"># Combine the title, Text widgets, and a button in a VBox</span>
    <span class="n">container</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="n">title_widget</span><span class="p">]</span> <span class="o">+</span> <span class="n">text_widgets</span><span class="p">)</span>

    <span class="c1"># Create a button to apply changes with text color #2596be and bold description</span>
    <span class="n">apply_button</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Apply Changes&quot;</span><span class="p">,</span>
        <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;button_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#2596be&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#2596be&quot;</span><span class="p">},</span>
    <span class="p">)</span>
    <span class="n">apply_button</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="n">apply_changes</span><span class="p">)</span>

    <span class="c1"># Display the container and apply button</span>
    <span class="n">display</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">apply_button</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="bunkatopics._bunkatopics.Bunka.rag_query" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">rag_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">llm</span><span class="p">,</span> <span class="n">top_doc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></code>

<a href="#bunkatopics._bunkatopics.Bunka.rag_query" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Executes a Retrieve-and-Generate (RAG) query using the provided language model and document set.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>query</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The query string to be processed.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>llm</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The language model used for generating answers.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>top_doc</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The number of top documents to retrieve for the query. Default is 2.</p>
            </div>
          </td>
          <td>
                <code>2</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The response from the RAG query, including the answer and source documents.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="note" open>
  <summary>Note</summary>
  <p>This method utilizes a RetrievalQA chain to answer queries. It retrieves relevant documents
based on the query and uses the language model to generate a response. The method is designed
to work with complex queries and provide informative answers using the document set.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>bunkatopics/_bunkatopics.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">rag_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">llm</span><span class="p">,</span> <span class="n">top_doc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Executes a Retrieve-and-Generate (RAG) query using the provided language model and document set.</span>

<span class="sd">    Args:</span>
<span class="sd">        query (str): The query string to be processed.</span>
<span class="sd">        llm: The language model used for generating answers.</span>
<span class="sd">        top_doc (int): The number of top documents to retrieve for the query. Default is 2.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The response from the RAG query, including the answer and source documents.</span>

<span class="sd">    Note:</span>
<span class="sd">        This method utilizes a RetrievalQA chain to answer queries. It retrieves relevant documents</span>
<span class="sd">        based on the query and uses the language model to generate a response. The method is designed</span>
<span class="sd">        to work with complex queries and provide informative answers using the document set.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Log a message indicating the query is being processed</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Answering your query, please wait a few seconds&quot;</span><span class="p">)</span>

    <span class="c1"># Create a RetrievalQA instance with the specified llm and retriever</span>
    <span class="n">qa_with_sources_chain</span> <span class="o">=</span> <span class="n">RetrievalQA</span><span class="o">.</span><span class="n">from_chain_type</span><span class="p">(</span>
        <span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
        <span class="n">retriever</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vectorstore</span><span class="o">.</span><span class="n">as_retriever</span><span class="p">(</span><span class="n">search_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;k&quot;</span><span class="p">:</span> <span class="n">top_doc</span><span class="p">}),</span>
        <span class="n">return_source_documents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Include source documents in the response</span>
    <span class="p">)</span>

    <span class="c1"># Provide the query to the RetrievalQA instance for answering</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">qa_with_sources_chain</span><span class="p">({</span><span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">})</span>

    <span class="k">return</span> <span class="n">response</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="bunkatopics._bunkatopics.Bunka.visualize_bourdieu" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">visualize_bourdieu</span><span class="p">(</span><span class="n">llm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_left_words</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;war&#39;</span><span class="p">],</span> <span class="n">x_right_words</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;peace&#39;</span><span class="p">],</span> <span class="n">y_top_words</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;men&#39;</span><span class="p">],</span> <span class="n">y_bottom_words</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;women&#39;</span><span class="p">],</span> <span class="n">height</span><span class="o">=</span><span class="mi">1500</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1500</span><span class="p">,</span> <span class="n">display_percent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">clustering</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">topic_n_clusters</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">topic_terms</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">topic_ngrams</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">topic_top_terms_overall</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">gen_topic_language</span><span class="o">=</span><span class="s1">&#39;english&#39;</span><span class="p">,</span> <span class="n">topic_gen_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">manual_axis_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_doc_gen_topic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">radius_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">convex_hull</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;delta&#39;</span><span class="p">,</span> <span class="n">label_size_ratio_clusters</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">label_size_ratio_label</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">label_size_ratio_percent</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span></code>

<a href="#bunkatopics._bunkatopics.Bunka.visualize_bourdieu" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Creates and visualizes a Bourdieu Map using specified parameters and a generative model.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>generative_model</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The generative model to be used. Default is None.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>x_left_words,</code></td>
          <td>
                <code>x_right_words (t.List[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Words defining the left and right axes.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y_top_words,</code></td>
          <td>
                <code>y_bottom_words (t.List[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Words defining the top and bottom axes.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>height,</code></td>
          <td>
                <code>width (int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dimensions of the visualization. Both default to 1500.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>display_percent</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Flag to display percentages on the map. Default is True.</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>clustering</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to apply clustering on the map. Default is False.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>topic_n_clusters</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Number of clusters for topic modeling. Default is 10.</p>
            </div>
          </td>
          <td>
                <code>10</code>
          </td>
        </tr>
        <tr>
          <td><code>topic_terms</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Length of topic names. Default is 2.</p>
            </div>
          </td>
          <td>
                <code>2</code>
          </td>
        </tr>
        <tr>
          <td><code>topic_ngrams</code></td>
          <td>
                <code><span title="typing.List">List</span>[int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>N-gram range for topic modeling. Default is [1, 2].</p>
            </div>
          </td>
          <td>
                <code>[1, 2]</code>
          </td>
        </tr>
        <tr>
          <td><code>topic_top_terms_overall</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Top terms to consider overall. Default is 1000.</p>
            </div>
          </td>
          <td>
                <code>1000</code>
          </td>
        </tr>
        <tr>
          <td><code>gen_topic_language</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Language for topic generation. Default is "english".</p>
            </div>
          </td>
          <td>
                <code>&#39;english&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>topic_gen_name</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Flag to generate topic names. Default is False.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>manual_axis_name</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[dict]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Custom axis names for the map. Default is None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>use_doc_gen_topic</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Flag to use document context in topic generation. Default is False.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>radius_size</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Radius size for the map isualization. Default is 0.3.</p>
            </div>
          </td>
          <td>
                <code>0.3</code>
          </td>
        </tr>
        <tr>
          <td><code>convex_hull</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to include a convex hull in the visualization. Default is True.</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>colorscale</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>colorscale for the Density Plot (Default is delta)</p>
            </div>
          </td>
          <td>
                <code>&#39;delta&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>density</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to display a density map</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>Returns</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>go.Figure: A Plotly graph object figure representing the Bourdieu Map.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

<details class="note" open>
  <summary>Note</summary>
  <p>The Bourdieu Map is a sophisticated visualization that plots documents and topics
based on specified word axes, using a generative model for dynamic analysis.
This method handles the complex process of generating and plotting this map,
offering a range of customization options for detailed analysis.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>bunkatopics/_bunkatopics.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">visualize_bourdieu</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">llm</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">x_left_words</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;war&quot;</span><span class="p">],</span>
    <span class="n">x_right_words</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;peace&quot;</span><span class="p">],</span>
    <span class="n">y_top_words</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;men&quot;</span><span class="p">],</span>
    <span class="n">y_bottom_words</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;women&quot;</span><span class="p">],</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">,</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">,</span>
    <span class="n">display_percent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">clustering</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">topic_n_clusters</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">topic_terms</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">topic_ngrams</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="n">topic_top_terms_overall</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">gen_topic_language</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;english&quot;</span><span class="p">,</span>
    <span class="n">topic_gen_name</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">manual_axis_name</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">use_doc_gen_topic</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">radius_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
    <span class="n">convex_hull</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">density</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">colorscale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;delta&quot;</span><span class="p">,</span>
    <span class="n">label_size_ratio_clusters</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="n">label_size_ratio_label</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">label_size_ratio_percent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates and visualizes a Bourdieu Map using specified parameters and a generative model.</span>

<span class="sd">    Args:</span>
<span class="sd">        generative_model (t.Optional[str]): The generative model to be used. Default is None.</span>
<span class="sd">        x_left_words, x_right_words (t.List[str]): Words defining the left and right axes.</span>
<span class="sd">        y_top_words, y_bottom_words (t.List[str]): Words defining the top and bottom axes.</span>
<span class="sd">        height, width (int): Dimensions of the visualization. Both default to 1500.</span>
<span class="sd">        display_percent (bool): Flag to display percentages on the map. Default is True.</span>
<span class="sd">        clustering (bool): Whether to apply clustering on the map. Default is False.</span>
<span class="sd">        topic_n_clusters (int): Number of clusters for topic modeling. Default is 10.</span>
<span class="sd">        topic_terms (int): Length of topic names. Default is 2.</span>
<span class="sd">        topic_ngrams (t.List[int]): N-gram range for topic modeling. Default is [1, 2].</span>
<span class="sd">        topic_top_terms_overall (int): Top terms to consider overall. Default is 1000.</span>
<span class="sd">        gen_topic_language (str): Language for topic generation. Default is &quot;english&quot;.</span>
<span class="sd">        topic_gen_name (bool): Flag to generate topic names. Default is False.</span>
<span class="sd">        manual_axis_name (t.Optional[dict]): Custom axis names for the map. Default is None.</span>
<span class="sd">        use_doc_gen_topic (bool): Flag to use document context in topic generation. Default is False.</span>
<span class="sd">        radius_size (float): Radius size for the map isualization. Default is 0.3.</span>
<span class="sd">        convex_hull (bool): Whether to include a convex hull in the visualization. Default is True.</span>
<span class="sd">        colorscale (str): colorscale for the Density Plot (Default is delta)</span>
<span class="sd">        density (bool): Whether to display a density map</span>


<span class="sd">        Returns:</span>
<span class="sd">            go.Figure: A Plotly graph object figure representing the Bourdieu Map.</span>

<span class="sd">    Note:</span>
<span class="sd">        The Bourdieu Map is a sophisticated visualization that plots documents and topics</span>
<span class="sd">        based on specified word axes, using a generative model for dynamic analysis.</span>
<span class="sd">        This method handles the complex process of generating and plotting this map,</span>
<span class="sd">        offering a range of customization options for detailed analysis.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating the Bourdieu Map&quot;</span><span class="p">)</span>
    <span class="n">topic_gen_param</span> <span class="o">=</span> <span class="n">TopicGenParam</span><span class="p">(</span>
        <span class="n">language</span><span class="o">=</span><span class="n">gen_topic_language</span><span class="p">,</span>
        <span class="n">top_doc</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">top_terms</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">use_doc</span><span class="o">=</span><span class="n">use_doc_gen_topic</span><span class="p">,</span>
        <span class="n">context</span><span class="o">=</span><span class="s2">&quot;everything&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">topic_param</span> <span class="o">=</span> <span class="n">TopicParam</span><span class="p">(</span>
        <span class="n">n_clusters</span><span class="o">=</span><span class="n">topic_n_clusters</span><span class="p">,</span>
        <span class="n">ngrams</span><span class="o">=</span><span class="n">topic_ngrams</span><span class="p">,</span>
        <span class="n">name_lenght</span><span class="o">=</span><span class="n">topic_terms</span><span class="p">,</span>
        <span class="n">top_terms_overall</span><span class="o">=</span><span class="n">topic_top_terms_overall</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">bourdieu_query</span> <span class="o">=</span> <span class="n">BourdieuQuery</span><span class="p">(</span>
        <span class="n">x_left_words</span><span class="o">=</span><span class="n">x_left_words</span><span class="p">,</span>
        <span class="n">x_right_words</span><span class="o">=</span><span class="n">x_right_words</span><span class="p">,</span>
        <span class="n">y_top_words</span><span class="o">=</span><span class="n">y_top_words</span><span class="p">,</span>
        <span class="n">y_bottom_words</span><span class="o">=</span><span class="n">y_bottom_words</span><span class="p">,</span>
        <span class="n">radius_size</span><span class="o">=</span><span class="n">radius_size</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Request Bourdieu API</span>

    <span class="n">bourdieu_api</span> <span class="o">=</span> <span class="n">BourdieuAPI</span><span class="p">(</span>
        <span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
        <span class="n">embedding_model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span>
        <span class="n">bourdieu_query</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bourdieu_query</span><span class="p">,</span>
        <span class="n">generative_ai_name</span><span class="o">=</span><span class="n">topic_gen_name</span><span class="p">,</span>
        <span class="n">topic_param</span><span class="o">=</span><span class="n">topic_param</span><span class="p">,</span>
        <span class="n">topic_gen_param</span><span class="o">=</span><span class="n">topic_gen_param</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">new_docs</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">)</span>
    <span class="n">new_terms</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">terms</span><span class="p">)</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">bourdieu_api</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span>
        <span class="n">docs</span><span class="o">=</span><span class="n">new_docs</span><span class="p">,</span>
        <span class="n">terms</span><span class="o">=</span><span class="n">new_terms</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">bourdieu_docs</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bourdieu_topics</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">visualizer</span> <span class="o">=</span> <span class="n">BourdieuVisualizer</span><span class="p">(</span>
        <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
        <span class="n">display_percent</span><span class="o">=</span><span class="n">display_percent</span><span class="p">,</span>
        <span class="n">convex_hull</span><span class="o">=</span><span class="n">convex_hull</span><span class="p">,</span>
        <span class="n">clustering</span><span class="o">=</span><span class="n">clustering</span><span class="p">,</span>
        <span class="n">manual_axis_name</span><span class="o">=</span><span class="n">manual_axis_name</span><span class="p">,</span>
        <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span>
        <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span>
        <span class="n">label_size_ratio_clusters</span><span class="o">=</span><span class="n">label_size_ratio_clusters</span><span class="p">,</span>
        <span class="n">label_size_ratio_label</span><span class="o">=</span><span class="n">label_size_ratio_label</span><span class="p">,</span>
        <span class="n">label_size_ratio_percent</span><span class="o">=</span><span class="n">label_size_ratio_percent</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">visualizer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bourdieu_docs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bourdieu_topics</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="bunkatopics._bunkatopics.Bunka.visualize_bourdieu_one_dimension" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">visualize_bourdieu_one_dimension</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;negative&#39;</span><span class="p">],</span> <span class="n">right</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;positive&#39;</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">explainer</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#bunkatopics._bunkatopics.Bunka.visualize_bourdieu_one_dimension" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Visualizes the document set on a one-dimensional Bourdieu axis.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>left</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of words representing the left side of the axis.</p>
            </div>
          </td>
          <td>
                <code>[&#39;negative&#39;]</code>
          </td>
        </tr>
        <tr>
          <td><code>right</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of words representing the right side of the axis.</p>
            </div>
          </td>
          <td>
                <code>[&#39;positive&#39;]</code>
          </td>
        </tr>
        <tr>
          <td><code>width</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Width of the generated visualization. Default is 800.</p>
            </div>
          </td>
          <td>
                <code>800</code>
          </td>
        </tr>
        <tr>
          <td><code>height</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Height of the generated visualization. Default is 800.</p>
            </div>
          </td>
          <td>
                <code>800</code>
          </td>
        </tr>
        <tr>
          <td><code>explainer</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Flag to include an explainer figure. Default is False.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="plotly.Figure">Figure</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>t.Tuple[go.Figure, t.Union[plt.Figure, None]]: A tuple containing the main visualization figure</p>
            </div>
          </td>
        </tr>
        <tr>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="matplotlib.Figure">Figure</span>, None]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>and an optional explainer figure (if explainer is True).</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="note" open>
  <summary>Note</summary>
  <p>This method creates a one-dimensional Bourdieu-style visualization, plotting documents along an
axis defined by contrasting word sets. It helps in understanding the distribution of documents
in terms of these contrasting word concepts. An optional explainer figure can provide additional
insight into specific terms used in the visualization.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>bunkatopics/_bunkatopics.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">visualize_bourdieu_one_dimension</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">left</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;negative&quot;</span><span class="p">],</span>
    <span class="n">right</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;positive&quot;</span><span class="p">],</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>
    <span class="n">explainer</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">t</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualizes the document set on a one-dimensional Bourdieu axis.</span>

<span class="sd">    Args:</span>
<span class="sd">        left (t.List[str]): List of words representing the left side of the axis.</span>
<span class="sd">        right (t.List[str]): List of words representing the right side of the axis.</span>
<span class="sd">        width (int): Width of the generated visualization. Default is 800.</span>
<span class="sd">        height (int): Height of the generated visualization. Default is 800.</span>
<span class="sd">        explainer (bool): Flag to include an explainer figure. Default is False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        t.Tuple[go.Figure, t.Union[plt.Figure, None]]: A tuple containing the main visualization figure</span>
<span class="sd">        and an optional explainer figure (if explainer is True).</span>

<span class="sd">    Note:</span>
<span class="sd">        This method creates a one-dimensional Bourdieu-style visualization, plotting documents along an</span>
<span class="sd">        axis defined by contrasting word sets. It helps in understanding the distribution of documents</span>
<span class="sd">        in terms of these contrasting word concepts. An optional explainer figure can provide additional</span>
<span class="sd">        insight into specific terms used in the visualization.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">model_bourdieu</span> <span class="o">=</span> <span class="n">BourdieuOneDimensionVisualizer</span><span class="p">(</span>
        <span class="n">embedding_model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span>
        <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span>
        <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
        <span class="n">explainer</span><span class="o">=</span><span class="n">explainer</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">model_bourdieu</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span>
        <span class="n">docs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="bunkatopics._bunkatopics.Bunka.visualize_dimensions" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">visualize_dimensions</span><span class="p">(</span><span class="n">dimensions</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;positive&#39;</span><span class="p">,</span> <span class="s1">&#39;negative&#39;</span><span class="p">,</span> <span class="s1">&#39;fear&#39;</span><span class="p">,</span> <span class="s1">&#39;love&#39;</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="s1">&#39;plotly_dark&#39;</span><span class="p">)</span></code>

<a href="#bunkatopics._bunkatopics.Bunka.visualize_dimensions" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Visualizes the similarity scores between a given query and the document set.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>query</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The query to be visualized against the documents. Default is "What is America?".</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>min_score</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The minimum similarity score threshold for visualization. Default is 0.2.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>width</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Width of the visualization. Default is 600.</p>
            </div>
          </td>
          <td>
                <code>500</code>
          </td>
        </tr>
        <tr>
          <td><code>height</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Height of the visualization. Default is 300.</p>
            </div>
          </td>
          <td>
                <code>500</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="plotly.Figure">Figure</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A tuple (fig, percent) where 'fig' is a Plotly graph object figure representing the</p>
            </div>
          </td>
        </tr>
        <tr>
          <td>
                <code><span title="plotly.Figure">Figure</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>visualization and 'percent' is the percentage of documents above the similarity threshold.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="note" open>
  <summary>Note</summary>
  <p>This method creates a visualization showing how closely documents in the set relate to
the specified query. Documents with similarity scores above the threshold are highlighted,
providing a visual representation of their relevance to the query.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>bunkatopics/_bunkatopics.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">visualize_dimensions</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dimensions</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;positive&quot;</span><span class="p">,</span> <span class="s2">&quot;negative&quot;</span><span class="p">,</span> <span class="s2">&quot;fear&quot;</span><span class="p">,</span> <span class="s2">&quot;love&quot;</span><span class="p">],</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">template</span><span class="o">=</span><span class="s2">&quot;plotly_dark&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualizes the similarity scores between a given query and the document set.</span>

<span class="sd">    Args:</span>
<span class="sd">        query (str): The query to be visualized against the documents. Default is &quot;What is America?&quot;.</span>
<span class="sd">        min_score (float): The minimum similarity score threshold for visualization. Default is 0.2.</span>
<span class="sd">        width (int): Width of the visualization. Default is 600.</span>
<span class="sd">        height (int): Height of the visualization. Default is 300.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A tuple (fig, percent) where &#39;fig&#39; is a Plotly graph object figure representing the</span>
<span class="sd">        visualization and &#39;percent&#39; is the percentage of documents above the similarity threshold.</span>

<span class="sd">    Note:</span>
<span class="sd">        This method creates a visualization showing how closely documents in the set relate to</span>
<span class="sd">        the specified query. Documents with similarity scores above the threshold are highlighted,</span>
<span class="sd">        providing a visual representation of their relevance to the query.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">final_df</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Computing Similarities&quot;</span><span class="p">)</span>
    <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">(</span><span class="n">feature_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">dimensions</span><span class="p">):</span>
        <span class="n">df_search</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>
        <span class="n">df_search</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorstore</span><span class="o">.</span><span class="n">similarity_search_with_score</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">df_search</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span>
            <span class="n">df_search</span><span class="p">[[</span><span class="s2">&quot;cosine_similarity_score&quot;</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="n">df_search</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dim</span>
        <span class="n">final_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_search</span><span class="p">)</span>
    <span class="n">final_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">final_df</span><span class="p">])</span>

    <span class="n">final_df_mean</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">final_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">)[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span>
        <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;mean_score&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">final_df_mean</span> <span class="o">=</span> <span class="n">final_df_mean</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
        <span class="s2">&quot;mean_score&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">final_df_mean</span><span class="p">[</span><span class="s2">&quot;rank&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_df_mean</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">df_dimensions</span> <span class="o">=</span> <span class="n">final_df_mean</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">line_polar</span><span class="p">(</span>
        <span class="n">final_df_mean</span><span class="p">,</span>
        <span class="n">r</span><span class="o">=</span><span class="s2">&quot;mean_score&quot;</span><span class="p">,</span>
        <span class="n">theta</span><span class="o">=</span><span class="s2">&quot;source&quot;</span><span class="p">,</span>
        <span class="n">line_close</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">template</span><span class="o">=</span><span class="n">template</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="bunkatopics._bunkatopics.Bunka.visualize_topics" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">visualize_topics</span><span class="p">(</span><span class="n">show_text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label_size_ratio</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;delta&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">convex_hull</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#bunkatopics._bunkatopics.Bunka.visualize_topics" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Generates a visualization of the identified topics in the document set.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>show_text</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to display text labels on the visualization. Default is True.</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>label_size_ratio</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The size ratio of the labels in the visualization. Default is 100.</p>
            </div>
          </td>
          <td>
                <code>100</code>
          </td>
        </tr>
        <tr>
          <td><code>width</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The width of the visualization figure. Default is 1000.</p>
            </div>
          </td>
          <td>
                <code>1000</code>
          </td>
        </tr>
        <tr>
          <td><code>height</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The height of the visualization figure. Default is 1000.</p>
            </div>
          </td>
          <td>
                <code>1000</code>
          </td>
        </tr>
        <tr>
          <td><code>colorscale</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>colorscale for the Density Plot (Default is delta)</p>
            </div>
          </td>
          <td>
                <code>&#39;delta&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>density</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to display a density map</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>convex_hull</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to display lines around the clusters</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="plotly.Figure">Figure</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>go.Figure: A Plotly graph object figure representing the topic visualization.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="note" open>
  <summary>Note</summary>
  <p>This method creates a 'Bunka Map', a graphical representation of the topics,
using Plotly for interactive visualization. It displays how documents are grouped
into topics and can include text labels for clarity.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>bunkatopics/_bunkatopics.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">visualize_topics</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">show_text</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">label_size_ratio</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">colorscale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;delta&quot;</span><span class="p">,</span>
    <span class="n">density</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">convex_hull</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a visualization of the identified topics in the document set.</span>

<span class="sd">    Args:</span>
<span class="sd">        show_text (bool): Whether to display text labels on the visualization. Default is True.</span>
<span class="sd">        label_size_ratio (int): The size ratio of the labels in the visualization. Default is 100.</span>
<span class="sd">        width (int): The width of the visualization figure. Default is 1000.</span>
<span class="sd">        height (int): The height of the visualization figure. Default is 1000.</span>
<span class="sd">        colorscale (str): colorscale for the Density Plot (Default is delta)</span>
<span class="sd">        density (bool): Whether to display a density map</span>
<span class="sd">        convex_hull (bool): Whether to display lines around the clusters</span>

<span class="sd">    Returns:</span>
<span class="sd">        go.Figure: A Plotly graph object figure representing the topic visualization.</span>

<span class="sd">    Note:</span>
<span class="sd">        This method creates a &#39;Bunka Map&#39;, a graphical representation of the topics,</span>
<span class="sd">        using Plotly for interactive visualization. It displays how documents are grouped</span>
<span class="sd">        into topics and can include text labels for clarity.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating the Bunka Map&quot;</span><span class="p">)</span>

    <span class="n">model_visualizer</span> <span class="o">=</span> <span class="n">TopicVisualizer</span><span class="p">(</span>
        <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
        <span class="n">show_text</span><span class="o">=</span><span class="n">show_text</span><span class="p">,</span>
        <span class="n">label_size_ratio</span><span class="o">=</span><span class="n">label_size_ratio</span><span class="p">,</span>
        <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span>
        <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span>
        <span class="n">convex_hull</span><span class="o">=</span><span class="n">convex_hull</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">model_visualizer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "navigation.instant", "navigation.top", "navigation.tracking", "toc.follow", "content.code.copy"], "search": "../assets/javascripts/workers/search.c011b7c0.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.7389ff0e.min.js"></script>
      
    
  </body>
</html>